---
layout: post
title: Merging
date: 2022-11-11 20:33:00 0330
# categories: "Unit1"
imgPath: ../../../assets/img/
---

merge کردن تماماً درباره‌ی جابجایی تغییرات از یک branch‌ به branch دیگری است. 

در گیت دو نوع merge داریم:

<h3 class="custum-title">Fast-forward merge</h3>

با توجه به تصویرِ زیر، در ابتدا master branch رو با سه تا کامیت داریم. branch جدیدی رو با اسمِ‌ BugFix می‌سازیم. همانطور که قبلاً هم کفتیم در گیت branch فقط یه اشاره‌گر به یک کامیت هستش. حالا دو اشاره‌گر یا branch به اسم‌هایِ master و bugfix رو داریم که هر دو به یک کامیت اشاره می‌کنن. 

به bugfix branch سوئیچ می‌کنیم و چند کامیت رو درش می‌سازیم. حالا می‌خواهیم این تغییرات رو به master branch هم بیاریم. به این دلیل که در اینجا، این دو branch انحرافی در مسیر‌شون نیست (و در یه خط مستقیم هستن) تنها کاری که گیت باید برای merge کردن این تغییرات بکنه این هست که اشاره‌گر master رو جلو بیاره. و این نوعِ merge رو Fast-Forward merge نامیده می‌گن. حالا که کارمون با bugfix branch تموم شد می‌تونیم اون رو حذف کنیم و با این کار اشاره‌گرِ bugfix رو حذف می‌کنیم. 

![img]({{ page.imgPath }}merging-1.gif#center)

 اگه در این مورد گیج شدین بذارین یه مثال در این مورد براتون بزنم. چند لحظه گیت رو فراموش کنین. تصور کنین که یه مسیر به اسمِ‌ master داریم و کدِ داخلِ این مسیر در نسخه‌ی 1.0 هست. یه کپی از این دایرکتوری می‌گیریم و اسمش رو bugfix می‌ذاریم. حالا هر دو یکی هستن. شروع به تغییراتی در دایرکتوریِ bugfix می‌کنیم و حالا نسخه‌ی 1.2 رو داریم. حالا می‌خواهیم این تغییرات رو به master ببریم. چطور این کار رو بکنیم؟

یه راهش اینه که تمامیِ این فایل‌های تویِ مسیرِ bugfix رو به master کپی کنیم ولی راه عالی‌ای برای حل این مشکل نیست. اگر هزاران فایل داشته باشیم چی؟ یه راهِ بهتری هم هست.

از آنجایی که هیچ تغییری در master نداریم و در اساساً چیزی که در master داریم نسخه‌ی اولیه bugfix هست، می‌تونیم خیلی راحت اسمِ bugfix رو به master تغییر بدیم. پس از این به بعد می‌تونیم بگین که این master جدید هست. ایده‌ی fast-forwarding خیلی شبیه به این مثال هستش. 

![img]({{ page.imgPath }}merging-2.gif#center)

پس اگر دو تا branch از هم جدا نیستن (diverge نیستن) و در یک مسیرِ خطی مستقیم هستن در این حالت گیت برای merge کردن از fast-forward merge استفاده می‌کنه.

<h3 class="custum-title">3-Way Merge</h3>

با توجه به تصویر، bugfix branch دو تا کامیت جلوتر از master branch هستش. اما قبل از اینکه بخواهیم bugfix branch رو با master branch ادغام کنیم به master سوئیچ می‌کنیم و کامیتِ جدیدی رو اضافه می‌کنیم. با این کار، مسیر branchهامون از هم جدا شد. در واقع، حالا تغییراتی در master داریم که در bugfix نیستش. در این شرایط اگه merge کنیم گیت نمی‌تونه اشاره‌گر master رو به جلو ببره تا به کامیتی که bugfix بهش اشاره داره، اشاره کنه. چون در غیر اینصورت آخرین کامیتِ تویِ master branch رو از دست می‌دیم. 

در این حالت، با عملِ merge، گیت یک کامیتِ‌ جدید می‌سازه که تغییرات رو از هر دو branch یکی می‌کنه. و این دلیلِ نامِ این نوع merge هستش. دلیلش اینه که این کامیتِ جدید براساس سه کامیتِ مختلفه: parent یکسانِ دو کامیت‌ که از اون بوجود اومدن (before code)، اولین کامیت‌هایِ فرزند که به پدر اشاره دارن (after code). پس گیت به سه snapshot مختلف نگاه می‌کنه. snapshot قبلی و snapshotهای بعدی. براساس این، گیت می‌فهمه که چطور باید تغییرات رو یکی کنه و این کامیتِ‌ جدید که یک merge commit هست رو بسازه. 

![img]({{ page.imgPath }}merging-3.gif#center)