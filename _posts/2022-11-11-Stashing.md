---
layout: post
title: Stashing
date: 2022-11-11 19:55:00 0330
# categories: "Unit1"
imgPath: ../../../assets/img/
---
**خلاصه**: تویِ branchای داریم کار می‌کنیم یهو مجبور می‌شیم بدون اینکه تغییراتِ تویِ branch فعلی‌مون رو کامیت کنیم به branch دیگری سوئیچ کنیم. ولی قبل اینکه عمل سوئیچ رو انجام بدیم باید تغییراتِ تویِ working directoryمون رو stash کنیم. منظور از stash یعنی این تغییرات رو در در جایی از ریپومون ذخیره کنیم.

برای اینکه فایل‌هایِ جدید ردیابی نشده‌ نیز شاملِ stash بشن از آپشنِ `all-—` استفاده می‌کنیم.

```bash
git stash push -am "New tax rules."
```

پس از دستورِ بالا مسیرِ‌کاری‌مون clean خواهد شد و می‌تونیم به branch دیگری سوئیچ کنیم.

لیست کردنِ stashها:

```bash
git stash list
```

قبل از اعمال stash می‌تونیم با دستورِ زیر تغییراتش رو مشاهده کنیم. 

```bash
git stash show 1
```

پس از مطمئن شدن می‌تونیم stash رو رویِ working directoryمون اعمال کنیم.

```bash
git stash apply 1
```

پس از اینکه کارمون با این stash تموم شد باید اون رو پاک کنیم تا همه‌چی تمیز‌تر بشه.  

```bash
git stash drop 1
```

برای اینکه تمامیِ stashها رو حذف کنیم از دستورِ زیر استفاده می‌کنیم.

```bash
git stash clear
```

---

همانطور که قبلاً گفته شد وقتی که به branch دیگری سوئیچ می‌کنیم گیت مسیرِ‌کاری‌مون رو به snapshotای که در آخرین کامیتِ‌ اون branch ذخیره شده، ریست می‌کنه. حالا اگه تغییراتِ محلی‌ای (local) در مسیرِ‌کاری‌مون داشته باشیم که هنوز کامیت نکردیم در این شرایط این تغییرات گم خواهند شد. و در این شرایط گیت اجازه‌ی سوئیچ به branch دیگری رو به ما نمی‌ده. 

بیایید این حالت رو شبیه‌سازی کنیم. قبل از اینکه به branch دیگری سوئیچ کنین مسیرِ‌کاری‌ای که الان توش هستین رو dirty کنین (یه سری تغییراتِ local درش انجام بدین). حالا بدون اینکه این تغییرات رو کامیت کنین به branch دیگری سوئیچ کنین. اینجاست که گیت پیغام خطایی مبنی بر این که local changeهایی که در فایل‌هایِ مشخص‌شده اعمال شدن ممکن هست که با checkout (یا سوئیچ شدن) overwrite (جایگزین) بشن. 

در ادامه‌ی این خطا گیت از ما می‌خواد که این تغییراتِ local رو یا commit کنیم و یا اونها رو قبل از سوئیچ کردن stash کنیم.

منظور از stash اینه که این تغییراتِ local رو در یک جایِ امن ذخیره‌شون کنیم. پس این تغییرات رو می‌خواهیم در جایی در repoمون ذخیره کنیم ولی این‌ها جزئی از historyمون نخواهند بود.  

به همین منظور از دستورِ زیر استفاده می‌کنیم. فرض می‌کنیم که داشتیم رویِ قوانینِ جدیدِ مالیاتی کار می‌کردیم و بعدش مجبور شدیم که سریعاً به bugfix branch سوئیچ کنیم.

```bash
git stash push -m "New tax rules."
```

حالا با دستورِ بالا مسیرِ‌کاری‌مون رو ذخیره کردیم. حالا یک stash داریم.

فقط یادتون باشه که به صورتِ‌ پیشفرض فایل‌های جدید ردیابی نشده داخلِ stash نمی‌رن. (منظور همون فایل‌هایی که statusشون `??` هست) برای اینکه بشه این فایل‌ها رو هم شاملِ stash کنیم باید از آپشنِ `all` استفاده کنیم. هر سه دستورِ زیر یکسان هستن و فقط شیوه‌ی نوشتنِ آپشن‌هاش در ظاهر با هم متفاوتن.

```bash
git stash push --all -m "My new stash"
```

```bash
git stash push -am "My new stash"
```

```bash
git stash push -a -m "My new stash"
```

برای دیدن لیستِ stashها از دستورِ زیر استفاده می‌کنیم. 

```bash
git stash list
```

خروجیِ دستورِ بالا بصورتِ زیر خواهد بود.

```
stash@{0}: On master: My new stash.
stash@{1}: On master: New tax rules.
```

با توجه به خروجیِ بالا هر کدوم از stashها آی‌دیِ مختصِ به خود رو دارن. (`{stash@{0`) داخلِ کروشه اندیس مربوط به هر stash نوشته شده. 

حالا با این کار مسیرِ‌کاری‌مون clean شد و می‌تونیم به branch دیگری سوئیچ کنیم. پس از اینکه دوباره به این branch برگشتیم باید یکی از stashها رو به مسیرِ‌کاری‌مون اعمال کنیم.

ولی بهتره قبلش به stashهامون یه نگاهی بندازیم. برای اینکه stashها رو مشخص کنیم یا از id اون stash و یا از indexش استفاده می‌کنیم.

```bash
git stash show 1
```

پس از مطمئن شدن می‌تونیم stash رو رویِ working directoryمون اعمال کنیم.

```bash
git stash apply 1
```

پس از اینکه کارمون با این stash تموم شد باید اون رو پاک کنیم تا همه‌چی تمیز‌تر بشه.  

```bash
git stash drop 1
```

برای اینکه تمامیِ stashها رو حذف کنیم از دستورِ زیر استفاده می‌کنیم.

```bash
git stash clear
```